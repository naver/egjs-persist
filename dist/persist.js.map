{"version":3,"file":"persist.js","sources":["../src/browser.js","../src/consts.js","../src/storageManager.js","../src/PersistQuotaExceededError.js","../src/utils.js","../src/Persist.js","../src/index.umd.js"],"sourcesContent":["const win = (typeof window !== `undefined` && window) || {};\n\nexport {win as window};\nexport const console = win.console;\nexport const document = win.document;\nexport const history = win.history;\nexport const location = win.location;\nexport const navigator = win.navigator;\nexport const parseFloat = win.parseFloat;\nexport const performance = win.performance;\n\nlet localStorage = null;\n\nlet sessionStorage = null;\n\ntry {\n\tlocalStorage = win.localStorage;\n\tsessionStorage = win.sessionStorage;\n} catch (e) {\n}\n\nexport {\n\tlocalStorage,\n\tsessionStorage,\n};\n","import {performance, navigator, parseFloat} from \"./browser\";\n\nexport const CONST_PERSIST = \"___persist___\";\nexport const CONST_PERSIST_STATE = `state${CONST_PERSIST}`;\nexport const CONST_DEPTHS = \"depths\";\nexport const CONST_LAST_URL = \"lastUrl\";\nconst navigation = performance && performance.navigation;\n\nexport const TYPE_NAVIGATE = (navigation && navigation.TYPE_NAVIGATE) || 0;\nexport const TYPE_RELOAD = (navigation && navigation.TYPE_RELOAD) || 1;\nexport const TYPE_BACK_FORWARD = (navigation && navigation.TYPE_BACK_FORWARD) || 2;\n\nconst userAgent = navigator ? navigator.userAgent : \"\";\n\nexport const IS_PERSIST_NEEDED = (function() {\n\tconst isIOS = (new RegExp(\"iPhone|iPad\", \"i\")).test(userAgent);\n\tconst isMacSafari = (new RegExp(\"Mac\", \"i\")).test(userAgent) &&\n\t\t!(new RegExp(\"Chrome\", \"i\")).test(userAgent) &&\n\t\t(new RegExp(\"Apple\", \"i\")).test(userAgent);\n\tconst isAndroid = (new RegExp(\"Android \", \"i\")).test(userAgent);\n\tconst isWebview = (new RegExp(\"wv; |inapp;\", \"i\")).test(userAgent);\n\tconst androidVersion = isAndroid ? parseFloat(new RegExp(\n\t\t\"(Android)\\\\s([\\\\d_\\\\.]+|\\\\d_0)\", \"i\"\n\t).exec(userAgent)[2]) : undefined;\n\n\treturn !(isIOS ||\n\t\t\tisMacSafari ||\n\t\t\t(isAndroid &&\n\t\t\t\t((androidVersion <= 4.3 && isWebview) || androidVersion < 3)));\n})();\n","import {window, history, location, sessionStorage, localStorage} from \"./browser\";\nimport {CONST_PERSIST} from \"./consts\";\n\nconst isSupportState = history && \"replaceState\" in history && \"state\" in history;\nlet storageType = \"None\";\n\nfunction isStorageAvailable(storage) {\n\tif (!storage) {\n\t\treturn undefined;\n\t}\n\tconst TMP_KEY = `__tmp__${CONST_PERSIST}`;\n\n\ttry {\n\t\t// In case of iOS safari private mode, calling setItem on storage throws error\n\t\tstorage.setItem(TMP_KEY, CONST_PERSIST);\n\n\t\t// In Chrome incognito mode, can not get saved value\n\t\t// In IE8, calling storage.getItem occasionally makes \"Permission denied\" error\n\t\treturn storage.getItem(TMP_KEY) === CONST_PERSIST;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nconst storage = (function() {\n\tlet strg;\n\n\tif (isStorageAvailable(sessionStorage)) {\n\t\tstrg = sessionStorage;\n\t\tstorageType = \"SessionStorage\";\n\t} else if (isStorageAvailable(localStorage)) {\n\t\tstrg = localStorage;\n\t\tstorageType = \"LocalStorage\";\n\t} else if (history && history.state) {\n\t\tstorageType = \"History\";\n\t}\n\n\treturn strg;\n})();\n\nfunction warnInvalidStorageValue() {\n\t/* eslint-disable no-console */\n\tconsole.warn(\"window.history or session/localStorage has no valid \" +\n\t\t\t\"format data to be handled in persist.\");\n\t/* eslint-enable no-console */\n}\n\n/*\n * Get state value\n */\nfunction getState(key) {\n\tlet state;\n\n\tlet stateStr;\n\n\tif (storage) {\n\t\tstateStr = storage.getItem(key);\n\t} else if (history.state) {\n\t\tif (typeof history.state === \"object\" && history.state !== null) {\n\t\t\tstateStr = history.state[key];\n\t\t} else {\n\t\t\twarnInvalidStorageValue();\n\t\t}\n\t} else {\n\t\tstateStr = history.state;\n\t}\n\n\t// the storage is clean\n\tif (stateStr === null) {\n\t\treturn {};\n\t}\n\n\t// \"null\" is not a valid\n\tconst isValidStateStr = typeof stateStr === \"string\" &&\n\t\t\t\t\t\t\t\tstateStr.length > 0 && stateStr !== \"null\";\n\n\ttry {\n\t\tstate = JSON.parse(stateStr);\n\n\t\t// like '[ ... ]', '1', '1.234', '\"123\"' is also not valid\n\t\tconst isValidType = !(typeof state !== \"object\" || state instanceof Array);\n\n\t\tif (!isValidStateStr || !isValidType) {\n\t\t\tthrow new Error();\n\t\t}\n\t} catch (e) {\n\t\twarnInvalidStorageValue();\n\t\tstate = {};\n\t}\n\n\t// Note2 (Android 4.3) return value is null\n\treturn state;\n}\n\n/*\n * Set state value\n */\nfunction setState(key, state) {\n\tif (storage) {\n\t\tif (state) {\n\t\t\tstorage.setItem(\n\t\t\t\tkey, JSON.stringify(state));\n\t\t} else {\n\t\t\tstorage.removeItem(key);\n\t\t}\n\t} else {\n\t\ttry {\n\t\t\tconst historyState = !history || history.state == null ? {} : history.state;\n\n\t\t\tif (history && typeof historyState === \"object\") {\n\t\t\t\thistoryState[key] = JSON.stringify(state);\n\t\t\t\thistory.replaceState(\n\t\t\t\t\thistoryState,\n\t\t\t\t\tdocument.title,\n\t\t\t\t\tlocation.href\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t/* eslint-disable no-console */\n\t\t\t\tconsole.warn(\"To use a history object, it must be an object that is not a primitive type.\");\n\t\t\t\t/* eslint-enable no-console */\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t/* eslint-disable no-console */\n\t\t\tconsole.warn(e.message);\n\t\t\t/* eslint-enable no-console */\n\t\t}\n\t}\n\n\tstate ? window[CONST_PERSIST] = true : delete window[CONST_PERSIST];\n}\n\n\nexport function getStorage() {\n\treturn storage;\n}\n\nexport function getStorageType() {\n\treturn storageType;\n}\n\nexport function getStateByKey(key, valueKey) {\n\tif (!isSupportState && !storage) {\n\t\treturn undefined;\n\t}\n\n\tlet result = getState(key)[valueKey];\n\n\t// some device returns \"null\" or undefined\n\tif (result === \"null\" || typeof result === \"undefined\") {\n\t\tresult = null;\n\t}\n\treturn result;\n}\n\nexport function setStateByKey(key, valueKey, data) {\n\tif (!isSupportState && !storage) {\n\t\treturn;\n\t}\n\n\tconst beforeData = getState(key);\n\n\tbeforeData[valueKey] = data;\n\tsetState(key, beforeData);\n}\n\n/*\n * flush current history state\n */\nexport function reset(key) {\n\tsetState(key, null);\n}\n","import {getStorage, getStorageType} from \"./storageManager\";\n\nconst setPrototypeOf = Object.setPrototypeOf || ((obj, proto) => {\n\t// eslint-disable-next-line no-proto\n\tobj.__proto__ = proto;\n\treturn obj;\n});\n\n\n/**\n * Special type of known error that {@link Persist} throws.\n * @ko Persist 내부에서 알려진 오류 발생시 throw되는 에러\n * @property {string} key Error key <ko>에러가 되는 키</ko>\n * @property {string} message Error message <ko>에러 메시지</ko>\n * @property {\"SessionStorage\" | \"LocalStorage\" | \"History\" | \"None\"} storageType The storage type in which the error occurred <ko>에러가 발생한 스토리지 타입</ko>\n * @property {number} size The size of the value in which the error occurred <ko>에러가 발생한 값의 사이즈</ko>\n * @property {Object} values Values of high size in storage. (maxLengh: 3) <ko>스토리지의 높은 사이즈의 값들. (최대 3개)</ko>\n * @example\n * ```ts\n * import Persist, { PersistQuotaExceededError } from \"@egjs/persist\";\n * try {\n *   const persist = new Persist(\"key\");\n * } catch (e) {\n *   if (e instanceof PersistQuotaExceededError) {\n *     console.error(\"size\", e.size);\n *   }\n * }\n * ```\n */\nclass PersistQuotaExceededError extends Error {\n\t/**\n\t * @param key Error message<ko>에러 메시지</ko>\n\t * @param value Error value<ko>에러 값</ko>\n\t */\n\tconstructor(key, value) {\n\t\tconst size = value.length;\n\t\tconst storageType = getStorageType();\n\t\tconst storage = getStorage();\n\t\tlet valuesText = \"\";\n\t\tlet values = [];\n\n\t\tif (storage) {\n\t\t\tconst length = storage.length;\n\n\t\t\tfor (let i = 0; i < length; ++i) {\n\t\t\t\tconst itemKey = storage.key(i);\n\t\t\t\tconst item = storage.getItem(itemKey) || \"\";\n\n\t\t\t\tvalues.push({key: itemKey, size: item.length});\n\t\t\t}\n\t\t\tvalues = values.sort((a, b) => b.size - a.size).slice(0, 3);\n\n\t\t\tif (values.length) {\n\t\t\t\tvaluesText = ` The highest values of ${storageType} are ${values.map(item => JSON.stringify({[item.key]: item.size})).join(\", \")}.`;\n\t\t\t}\n\t\t}\n\n\t\tsuper(`Setting the value (size: ${size}) of '${key}' exceeded the ${storageType}'s quota.${valuesText}`);\n\n\t\tsetPrototypeOf(this, PersistQuotaExceededError.prototype);\n\t\tthis.name = \"PersistQuotaExceededError\";\n\t\tthis.storageType = storageType;\n\t\tthis.key = key;\n\t\tthis.size = size;\n\t\tthis.values = values;\n\t}\n}\n\nexport default PersistQuotaExceededError;\n","import {navigator, parseFloat, performance, location} from \"./browser\";\nimport {CONST_PERSIST} from \"./consts\";\n\nconst userAgent = navigator ? navigator.userAgent : \"\";\n\nexport const isNeeded = (function() {\n\tconst isIOS = (new RegExp(\"iPhone|iPad\", \"i\")).test(userAgent);\n\tconst isMacSafari = (new RegExp(\"Mac\", \"i\")).test(userAgent) &&\n\t\t!(new RegExp(\"Chrome\", \"i\")).test(userAgent) &&\n\t\t(new RegExp(\"Apple\", \"i\")).test(userAgent);\n\tconst isAndroid = (new RegExp(\"Android \", \"i\")).test(userAgent);\n\tconst isWebview = (new RegExp(\"wv; |inapp;\", \"i\")).test(userAgent);\n\tconst androidVersion = isAndroid ? parseFloat(new RegExp(\n\t\t\"(Android)\\\\s([\\\\d_\\\\.]+|\\\\d_0)\", \"i\"\n\t).exec(userAgent)[2]) : undefined;\n\n\treturn !(isIOS ||\n\t\t\tisMacSafari ||\n\t\t\t(isAndroid &&\n\t\t\t\t((androidVersion <= 4.3 && isWebview) || androidVersion < 3)));\n})();\n\n// In case of IE8, TYPE_BACK_FORWARD is undefined.\nexport function getNavigationType() {\n\treturn performance && performance.navigation &&\n\t\tperformance.navigation.type;\n}\n\nexport function getUrl() {\n\treturn location ? location.href.split(\"#\")[0] : \"\";\n}\n\nexport function getStorageKey(name) {\n\treturn name + CONST_PERSIST;\n}\n\nexport function isQuotaExceededError(e) {\n\treturn e.name === \"QuotaExceededError\" || e.name === \"PersistQuotaExceededError\";\n}\n","/* eslint-disable no-use-before-define */\nimport {\n\treset,\n\tsetStateByKey,\n\tgetStateByKey,\n\tgetStorage,\n} from \"./storageManager\";\nimport PersistQuotaExceededError from \"./PersistQuotaExceededError\";\nimport {isNeeded, getUrl, getStorageKey, getNavigationType, isQuotaExceededError} from \"./utils\";\nimport {console, window} from \"./browser\";\nimport {TYPE_BACK_FORWARD, TYPE_NAVIGATE, CONST_PERSIST_STATE, CONST_DEPTHS, CONST_LAST_URL} from \"./consts\";\n\nlet currentUrl = \"\";\n\n\nfunction execRec(obj, path, func) {\n\tlet _obj = obj;\n\n\tif (!_obj) {\n\t\t_obj = isNaN(path[0]) ? {} : [];\n\t}\n\n\tconst head = path.shift();\n\n\tif (path.length === 0) {\n\t\tif (_obj instanceof Array && isNaN(head)) {\n\t\t\tconsole.warn(\"Don't use key string on array\");\n\t\t}\n\t\tfunc(_obj, head);\n\t\treturn _obj;\n\t}\n\n\t_obj[head] = execRec(_obj[head], path, func);\n\treturn _obj;\n}\n\nfunction setPersistState(key, value) {\n\ttry {\n\t\tsetStateByKey(CONST_PERSIST_STATE, key, value);\n\t} catch (e) {\n\t\tif (catchQuotaExceededError(e, CONST_PERSIST_STATE, value)) {\n\t\t\tif (key === CONST_LAST_URL) {\n\t\t\t\tsetPersistState(key, value);\n\t\t\t} else if (key === CONST_DEPTHS) {\n\t\t\t\tsetPersistState(key, value && value.slice(1));\n\t\t\t}\n\t\t}\n\t}\n}\nfunction getPersistState(key) {\n\treturn getStateByKey(CONST_PERSIST_STATE, key);\n}\n\nfunction replaceDepth() {\n\tconst url = getUrl();\n\n\tif (currentUrl === url) {\n\t\treturn;\n\t}\n\tconst prevUrl = currentUrl;\n\n\ttry {\n\t\tcurrentUrl = url;\n\n\t\tconst depths = getPersistState(CONST_DEPTHS) || [];\n\n\t\t// remove prev url\n\t\tconst prevIndex = depths.indexOf(prevUrl);\n\n\t\tif (prevIndex >= 0) {\n\t\t\tdepths.splice(prevIndex, 1);\n\t\t\treset(getStorageKey(prevUrl));\n\t\t}\n\n\t\t// remove next url info\n\t\tconst currentIndex = depths.indexOf(url);\n\n\t\tif (currentIndex >= 0) {\n\t\t\tdepths.splice(currentIndex, 1);\n\t\t\treset(getStorageKey(url));\n\t\t}\n\n\t\tdepths.push(url);\n\t\tsetPersistState(CONST_DEPTHS, depths);\n\t\tsetPersistState(CONST_LAST_URL, url);\n\t} catch (e) {\n\t\t// revert currentUrl\n\t\tcurrentUrl = prevUrl;\n\t\tthrow e;\n\t}\n}\n\nfunction updateDepth(type = 0) {\n\tconst url = getUrl();\n\n\tif (currentUrl === url) {\n\t\treturn;\n\t}\n\t// url is not the same for the first time, pushState, or replaceState.\n\tconst prevUrl = currentUrl;\n\n\ttry {\n\t\tcurrentUrl = url;\n\t\tconst depths = getPersistState(CONST_DEPTHS) || [];\n\n\t\tif (type === TYPE_BACK_FORWARD) {\n\t\t\t// Change current url only\n\t\t\tconst currentIndex = depths.indexOf(url);\n\n\t\t\t~currentIndex && setPersistState(CONST_LAST_URL, url);\n\t\t} else {\n\t\t\tconst prevLastUrl = getPersistState(CONST_LAST_URL);\n\n\t\t\treset(getStorageKey(url));\n\n\t\t\tif (type === TYPE_NAVIGATE && url !== prevLastUrl) {\n\t\t\t\t// Remove all url lists with higher index than current index\n\t\t\t\tconst prevLastIndex = depths.indexOf(prevLastUrl);\n\t\t\t\tconst removedList = depths.splice(prevLastIndex + 1, depths.length);\n\n\t\t\t\tremovedList.forEach(removedUrl => {\n\t\t\t\t\treset(getStorageKey(removedUrl));\n\t\t\t\t});\n\t\t\t\t// If the type is NAVIGATE and there is information about current url, delete it.\n\t\t\t\tconst currentIndex = depths.indexOf(url);\n\n\t\t\t\t~currentIndex && depths.splice(currentIndex, 1);\n\t\t\t}\n\t\t\t// Add depth for new address.\n\t\t\tif (depths.indexOf(url) < 0) {\n\t\t\t\tdepths.push(url);\n\t\t\t}\n\t\t\tsetPersistState(CONST_DEPTHS, depths);\n\t\t\tsetPersistState(CONST_LAST_URL, url);\n\t\t}\n\t} catch (e) {\n\t\t// revert currentUrl\n\t\tcurrentUrl = prevUrl;\n\t\tthrow e;\n\t}\n}\n\nfunction catchQuotaExceededError(e, key, value) {\n\tif (clearFirst()) {\n\t\treturn true;\n\t} else if (isQuotaExceededError(e)) {\n\t\tthrow new PersistQuotaExceededError(key, value ? JSON.stringify(value) : \"\");\n\t} else {\n\t\tthrow e;\n\t}\n}\n\nfunction clearFirst() {\n\tconst depths = getPersistState(CONST_DEPTHS) || [];\n\tconst removed = depths.splice(0, 1);\n\n\tif (!removed.length) {\n\t\t// There is an error because there is no depth to add data.\n\t\treturn false;\n\t}\n\tconst removedUrl = removed[0];\n\n\treset(getStorageKey(removedUrl));\n\tif (currentUrl === removedUrl) {\n\t\tcurrentUrl = \"\";\n\t\tsetPersistState(CONST_LAST_URL, \"\");\n\t\tif (!depths.length) {\n\t\t\t// I tried to add myself, but it didn't add up, so I got an error.\n\t\t\treturn false;\n\t\t}\n\t}\n\tsetPersistState(CONST_DEPTHS, depths);\n\t// Clear the previous record and try to add data again.\n\treturn true;\n}\n\nfunction clear() {\n\tconst depths = getPersistState(CONST_DEPTHS) || [];\n\n\tdepths.forEach(url => {\n\t\treset(getStorageKey(url));\n\t});\n\n\treset(CONST_PERSIST_STATE);\n\n\tcurrentUrl = \"\";\n}\n\n/**\n * Get or store the current state of the web page using JSON.\n * @ko 웹 페이지의 현재 상태를 JSON 형식으로 저장하거나 읽는다.\n * @alias eg.Persist\n *\n * @support {\"ie\": \"9+\", \"ch\" : \"latest\", \"ff\" : \"latest\",  \"sf\" : \"latest\" , \"edge\" : \"latest\", \"ios\" : \"7+\", \"an\" : \"2.3+ (except 3.x)\"}\n */\nclass Persist {\n\tstatic VERSION = \"#__VERSION__#\";\n\tstatic StorageManager = {\n\t\treset,\n\t\tsetStateByKey,\n\t\tgetStateByKey,\n\t\tgetStorage,\n\t};\n\t/**\n\t * @static\n\t * Clear all information in Persist\n\t */\n\tstatic clear() {\n\t\tclear();\n\t}\n\t/**\n\t * @static\n\t * Return whether you need \"Persist\" module by checking the bfCache support of the current browser\n\t * @return {Boolean}\n\t */\n\tstatic isNeeded() {\n\t\treturn isNeeded;\n\t}\n\t/**\n\t* Constructor\n\t* @param {String} key The key of the state information to be stored <ko>저장할 상태 정보의 키</ko>\n\t**/\n\tconstructor(key) {\n\t\tthis.key = key || \"\";\n\t}\n\n\t/**\n\t * Read value\n\t * @param {String?} path target path\n\t * @return {String|Number|Boolean|Object|Array}\n\t */\n\tget(path) {\n\t\t// update url for pushState, replaceState\n\t\tupdateDepth(TYPE_NAVIGATE);\n\n\t\t// find path\n\t\tconst urlKey = getStorageKey(getUrl());\n\t\tconst globalState = getStateByKey(urlKey, this.key);\n\n\n\t\tif (!path || path.length === 0) {\n\t\t\treturn globalState;\n\t\t}\n\n\t\tconst pathToken = path.split(\".\");\n\n\t\tlet currentItem = globalState;\n\n\t\tlet isTargetExist = true;\n\n\t\tfor (let i = 0; i < pathToken.length; i++) {\n\t\t\tif (!currentItem) {\n\t\t\t\tisTargetExist = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcurrentItem = currentItem[pathToken[i]];\n\t\t}\n\t\tif (!isTargetExist || currentItem == null) {\n\t\t\treturn null;\n\t\t}\n\t\treturn currentItem;\n\t}\n\t/**\n\t * Save value\n\t * @param {String} path target path\n\t * @param {String|Number|Boolean|Object|Array} value value to save\n\t * @return {Persist}\n\t */\n\tset(path, value) {\n\t\t// update url for pushState, replaceState\n\t\tupdateDepth(TYPE_NAVIGATE);\n\t\t// find path\n\t\tconst key = this.key;\n\t\tconst urlKey = getStorageKey(getUrl());\n\t\tconst globalState = getStateByKey(urlKey, key);\n\n\t\ttry {\n\t\t\tif (path.length === 0) {\n\t\t\t\tsetStateByKey(urlKey, key, value);\n\t\t\t} else {\n\t\t\t\tconst allValue = execRec(globalState, path.split(\".\"), (obj, head) => {\n\t\t\t\t\tobj[head] = value;\n\t\t\t\t});\n\n\t\t\t\tsetStateByKey(\n\t\t\t\t\turlKey,\n\t\t\t\t\tkey,\n\t\t\t\t\tallValue\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (catchQuotaExceededError(e, urlKey, value)) {\n\t\t\t\tthis.set(path, value);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\t/**\n\t * Remove value\n\t * @param {String} path target path\n\t * @return {Persist}\n\t */\n\tremove(path) {\n\t\t// update url for pushState, replaceState\n\t\tupdateDepth(TYPE_NAVIGATE);\n\n\t\t// find path\n\t\tconst key = this.key;\n\t\tconst urlKey = getStorageKey(getUrl());\n\t\tconst globalState = getStateByKey(urlKey, key);\n\n\t\ttry {\n\t\t\tif (path.length === 0) {\n\t\t\t\tsetStateByKey(urlKey, key, null);\n\t\t\t} else {\n\t\t\t\tconst value = execRec(globalState, path.split(\".\"), (obj, head) => {\n\t\t\t\t\tif (typeof obj === \"object\") {\n\t\t\t\t\t\tdelete obj[head];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tsetStateByKey(\n\t\t\t\t\turlKey,\n\t\t\t\t\tkey,\n\t\t\t\t\tvalue\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (catchQuotaExceededError(e)) {\n\t\t\t\tthis.remove(path);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n}\n\n\nif (\"onpopstate\" in window) {\n\twindow.addEventListener(\"popstate\", () => {\n\t\t// popstate event occurs when backward or forward\n\t\ttry {\n\t\t\tupdateDepth(TYPE_BACK_FORWARD);\n\t\t} catch (e) {\n\t\t\t// Global function calls prevent errors.\n\t\t\tif (!isQuotaExceededError(e)) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t});\n}\n\n// If navigation's type is not TYPE_BACK_FORWARD, delete information about current url.\ntry {\n\tupdateDepth(getNavigationType());\n} catch (e) {\n\t// Global function calls prevent errors.\n\tif (!isQuotaExceededError(e)) {\n\t\tthrow e;\n\t}\n}\n\nexport {\n\tupdateDepth,\n\treplaceDepth,\n};\n\nexport default Persist;\n","import Persist, * as modules from \"./index\";\n\nfor (const name in modules) {\n\tPersist[name] = modules[name];\n}\n\nexport default Persist;\n"],"names":["win","window","console","document","history","location","navigator","parseFloat","performance","localStorage","sessionStorage","e","CONST_PERSIST","CONST_PERSIST_STATE","CONST_DEPTHS","CONST_LAST_URL","navigation","TYPE_NAVIGATE","TYPE_RELOAD","TYPE_BACK_FORWARD","userAgent","IS_PERSIST_NEEDED","isIOS","RegExp","test","isMacSafari","isAndroid","isWebview","androidVersion","exec","undefined","isSupportState","storageType","isStorageAvailable","storage","TMP_KEY","setItem","getItem","strg","state","warnInvalidStorageValue","warn","getState","key","stateStr","isValidStateStr","length","JSON","parse","isValidType","Array","Error","setState","stringify","removeItem","historyState","replaceState","title","href","message","getStorage","getStorageType","getStateByKey","valueKey","result","setStateByKey","data","beforeData","reset","setPrototypeOf","Object","obj","proto","__proto__","PersistQuotaExceededError","value","size","valuesText","values","i","itemKey","item","push","sort","a","b","slice","map","join","prototype","name","isNeeded","getNavigationType","type","getUrl","split","getStorageKey","isQuotaExceededError","currentUrl","execRec","path","func","_obj","isNaN","head","shift","setPersistState","catchQuotaExceededError","getPersistState","replaceDepth","url","prevUrl","depths","prevIndex","indexOf","splice","currentIndex","updateDepth","prevLastUrl","prevLastIndex","removedList","forEach","removedUrl","clearFirst","removed","clear","Persist","get","urlKey","globalState","pathToken","currentItem","isTargetExist","set","allValue","remove","VERSION","StorageManager","addEventListener","modules"],"mappings":"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"}