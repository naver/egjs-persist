!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.eg=t.eg||{},t.eg.Persist=e())}(this,function(){"use strict";var r="undefined"!=typeof window&&window||{},a=r.console,o=(r.document,r.history),t=r.localStorage,i=r.location,e=r.sessionStorage,n=r.navigator,s=r.parseFloat,f=r.performance,c="___persist___",u="state"+c,l="depths",p="lastUrl",g=f&&f.navigation,v=g&&g.TYPE_NAVIGATE||0,d=(g&&g.TYPE_RELOAD,g&&g.TYPE_BACK_FORWARD||2),h=o&&"replaceState"in o&&"state"in o;function y(t){if(t){var e="__tmp__"+c;try{return t.setItem(e,c),t.getItem(e)===c}catch(t){return!1}}}var w,m=(y(e)?w=e:y(t)&&(w=t),w);function E(){console.warn("window.history or session/localStorage has no valid format data to be handled in persist.")}function _(){return m}function x(t){var e,n;if(m?n=m.getItem(t):o.state?"object"==typeof o.state&&null!==o.state?n=o.state[t]:E():n=o.state,null===n)return{};var r="string"==typeof n&&0<n.length&&"null"!==n;try{var i=!("object"!=typeof(e=JSON.parse(n))||e instanceof Array);if(!r||!i)throw new Error}catch(t){E(),e={}}return e}function S(t,e){if(h||m){var n=x(t)[e];return"null"!==n&&void 0!==n||(n=null),n}}function A(t,e){if(m)e?m.setItem(t,JSON.stringify(e)):m.removeItem(t);else try{var n=o&&null!=o.state?o.state:{};o&&"object"==typeof n?(n[t]=JSON.stringify(e),o.replaceState(n,document.title,i.href)):console.warn("To use a history object, it must be an object that is not a primitive type.")}catch(t){console.warn(t.message)}e?r[c]=!0:delete r[c]}function R(t,e,n){if(h||m){var r=x(t);r[e]=n,A(t,r)}}function N(t){A(t,null)}var O,b,I,j,P,k=n?n.userAgent:"",T=(O=new RegExp("iPhone|iPad","i").test(k),b=new RegExp("Mac","i").test(k)&&!new RegExp("Chrome","i").test(k)&&new RegExp("Apple","i").test(k),I=new RegExp("Android ","i").test(k),j=new RegExp("wv; |inapp;","i").test(k),P=I?s(new RegExp("(Android)\\s([\\d_\\.]+|\\d_0)","i").exec(k)[2]):void 0,!(O||b||I&&(P<=4.3&&j||P<3)));function B(){return location.href.split("#")[0]}function D(t){return t+c}var J="";function K(e,n){try{R(u,e,n)}catch(t){if(!F())throw t;e===p?K(e,n):e===l&&K(e,n&&n.slice(1))}}function Y(t){return S(u,t)}function C(t){var e=B();if(J!==e){J=e;var n=Y(l)||[];if(t===d){~n.indexOf(J)&&K(p,J)}else{var r=Y(p);if(N(D(J)),t===v&&e!==r){var i=n.indexOf(r);n.splice(i+1,n.length).forEach(function(t){N(D(t))});var o=n.indexOf(J);~o&&n.splice(o,1)}n.indexOf(e)<0&&n.push(e),K(l,n),K(p,e)}}}function F(){var t=Y(l)||[],e=t.splice(0,1);if(!e.length)return!1;var n=e[0];return N(D(n)),!(J===n&&(K(p,J=""),!t.length))&&(K(l,t),!0)}"onpopstate"in r&&r.addEventListener("popstate",function(){C(d)});var L=function(){var t=function(){function t(t){this.key=t||""}t.clear=function(){(Y(l)||[]).forEach(function(t){N(D(t))}),N(u),J=""},t.isNeeded=function(){return T};var e=t.prototype;return e.get=function(t){var e=D(B());C(v);var n=S(e,this.key);if(!t||0===t.length)return n;for(var r=t.split("."),i=n,o=!0,a=0;a<r.length;a++){if(!i){o=!1;break}i=i[r[a]]}return o&&null!=i?i:null},e.set=function(e,n){var t=D(B());C(v);var r=this.key,i=S(t,r);try{0===e.length?R(t,r,n):R(t,r,function t(e,n,r){var i=e;i||(i=isNaN(n[0])?{}:[]);var o=n.shift();return 0===n.length?(i instanceof Array&&isNaN(o)&&a.warn("Don't use key string on array"),i[o]=r):i[o]=t(i[o],n,r),i}(i,e.split("."),n))}catch(t){if(!F())throw t;this.set(e,n)}return this},t}();return t.VERSION="2.2.1",t.StorageManager={reset:N,setStateByKey:R,getStateByKey:S,getStorage:_},t}();return C(f&&f.navigation&&f.navigation.type),L});
//# sourceMappingURL=persist.min.js.map
