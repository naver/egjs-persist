{"version":3,"file":"persist-migrate.js","sources":["../src/browser.js","../src/consts.js","../src/utils.js","../src/persist-migrate.js"],"sourcesContent":["const win = (typeof window !== `undefined` && window) || {};\n\nexport {win as window};\nexport const console = win.console;\nexport const document = win.document;\nexport const history = win.history;\nexport const location = win.location;\nexport const navigator = win.navigator;\nexport const parseFloat = win.parseFloat;\nexport const performance = win.performance;\n\nlet localStorage = null;\n\nlet sessionStorage = null;\n\ntry {\n\tlocalStorage = win.localStorage;\n\tsessionStorage = win.sessionStorage;\n} catch (e) {\n}\n\nexport {\n\tlocalStorage,\n\tsessionStorage,\n};\n","import {performance, navigator, parseFloat} from \"./browser\";\n\nexport const CONST_PERSIST = \"___persist___\";\nexport const CONST_PERSIST_STATE = `state${CONST_PERSIST}`;\nexport const CONST_DEPTHS = \"depths\";\nexport const CONST_LAST_URL = \"lastUrl\";\nconst navigation = performance && performance.navigation;\n\nexport const TYPE_NAVIGATE = (navigation && navigation.TYPE_NAVIGATE) || 0;\nexport const TYPE_RELOAD = (navigation && navigation.TYPE_RELOAD) || 1;\nexport const TYPE_BACK_FORWARD = (navigation && navigation.TYPE_BACK_FORWARD) || 2;\n\nconst userAgent = navigator ? navigator.userAgent : \"\";\n\nexport const IS_PERSIST_NEEDED = (function() {\n\tconst isIOS = (new RegExp(\"iPhone|iPad\", \"i\")).test(userAgent);\n\tconst isMacSafari = (new RegExp(\"Mac\", \"i\")).test(userAgent) &&\n\t\t!(new RegExp(\"Chrome\", \"i\")).test(userAgent) &&\n\t\t(new RegExp(\"Apple\", \"i\")).test(userAgent);\n\tconst isAndroid = (new RegExp(\"Android \", \"i\")).test(userAgent);\n\tconst isWebview = (new RegExp(\"wv; |inapp;\", \"i\")).test(userAgent);\n\tconst androidVersion = isAndroid ? parseFloat(new RegExp(\n\t\t\"(Android)\\\\s([\\\\d_\\\\.]+|\\\\d_0)\", \"i\"\n\t).exec(userAgent)[2]) : undefined;\n\n\treturn !(isIOS ||\n\t\t\tisMacSafari ||\n\t\t\t(isAndroid &&\n\t\t\t\t((androidVersion <= 4.3 && isWebview) || androidVersion < 3)));\n})();\n","import {navigator, parseFloat, performance, location} from \"./browser\";\nimport {CONST_PERSIST} from \"./consts\";\n\nconst userAgent = navigator ? navigator.userAgent : \"\";\n\nexport const isNeeded = (function() {\n\tconst isIOS = (new RegExp(\"iPhone|iPad\", \"i\")).test(userAgent);\n\tconst isMacSafari = (new RegExp(\"Mac\", \"i\")).test(userAgent) &&\n\t\t!(new RegExp(\"Chrome\", \"i\")).test(userAgent) &&\n\t\t(new RegExp(\"Apple\", \"i\")).test(userAgent);\n\tconst isAndroid = (new RegExp(\"Android \", \"i\")).test(userAgent);\n\tconst isWebview = (new RegExp(\"wv; |inapp;\", \"i\")).test(userAgent);\n\tconst androidVersion = isAndroid ? parseFloat(new RegExp(\n\t\t\"(Android)\\\\s([\\\\d_\\\\.]+|\\\\d_0)\", \"i\"\n\t).exec(userAgent)[2]) : undefined;\n\n\treturn !(isIOS ||\n\t\t\tisMacSafari ||\n\t\t\t(isAndroid &&\n\t\t\t\t((androidVersion <= 4.3 && isWebview) || androidVersion < 3)));\n})();\n\n// In case of IE8, TYPE_BACK_FORWARD is undefined.\nexport function getNavigationType() {\n\treturn performance && performance.navigation &&\n\t\tperformance.navigation.type;\n}\n\nexport function getUrl() {\n\treturn location ? location.href.split(\"#\")[0] : \"\";\n}\n\nexport function getStorageKey(name) {\n\treturn name + CONST_PERSIST;\n}\n\nexport function isQuotaExceededError(e) {\n\treturn e.name === \"QuotaExceededError\" || e.name === \"PersistQuotaExceededError\";\n}\n","/* eslint-disable */\nimport {window} from \"./browser\";\nimport { getStorageKey, getUrl } from \"./utils\";\n\nexport default (function(eg) {\n\tif (!eg || !eg.Persist) {\n\t\treturn;\n\t}\n\n\tvar GLOBAL_KEY = \"KEY___persist___\";\n\tvar oldConstructor = eg.Persist.prototype;\n\tvar isNeeded = eg.Persist.isNeeded;\n\tvar StorageManager = eg.Persist.StorageManager;\n\n\teg.Persist = function Persist(key, value) {\n\t\tconst urlKey = getStorageKey(getUrl());\n\t\t// when called as plain method\n\t\tif (!(this instanceof Persist)) {\n\t\t\tif (arguments.length === 0) {\n\t\t\t\treturn StorageManager.getStateByKey(urlKey, GLOBAL_KEY);\n\t\t\t}\n\n\t\t\tif (arguments.length === 1 && typeof key !== \"string\") {\n\t\t\t\tvar value_ = key;\n\n\t\t\t\tStorageManager.setStateByKey(urlKey, GLOBAL_KEY, value_);\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (arguments.length === 2) {\n\t\t\t\tStorageManager.setStateByKey(urlKey, key, value);\n\t\t\t}\n\n\t\t\treturn StorageManager.getStateByKey(urlKey, key);\n\t\t}\n\n\t\t// when called as constructer\n\t\tthis.key = key;\n\t\treturn undefined;\n\t};\n\teg.Persist.isNeeded = isNeeded;\n\teg.Persist.prototype = oldConstructor;\n\treturn eg.Persist;\n})(window.eg);\n\n/* eslint-enable */\n"],"names":["win","window","console","document","history","location","navigator","parseFloat","performance","localStorage","sessionStorage","e","CONST_PERSIST","navigation","TYPE_NAVIGATE","TYPE_RELOAD","TYPE_BACK_FORWARD","userAgent","IS_PERSIST_NEEDED","isIOS","RegExp","test","isMacSafari","isAndroid","isWebview","androidVersion","exec","undefined","isNeeded","getUrl","href","split","getStorageKey","name","eg","Persist","GLOBAL_KEY","oldConstructor","prototype","StorageManager","key","value","urlKey","arguments","length","getStateByKey","value_","setStateByKey"],"mappings":"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"}